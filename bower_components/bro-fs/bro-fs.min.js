/*! bro-fs v0.4.0 */
!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.fs=r():e.fs=r()}(this,function(){return function(e){function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}var t={};return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=4)}([function(e,r,t){"use strict";function n(e){return function(){for(var r=arguments.length,t=[];r--;)t[r]=arguments[r];0===t.length?e():e(1===t.length?t[0]:t)}}function i(e,r,t,n){return function(i){var o="";try{o=JSON.stringify(t)}catch(e){o=t.join(", ")}e.name=i.name,e.message=i.message+" Call: "+r+"("+o+")",n(e)}}r.promiseCall=function(e,r){if(!e)throw new Error("Can't call promisified method '"+r+"' of "+e);var t=[].slice.call(arguments,2);return new Promise(function(o,u){var a=n(o),c=i(new Error,r,t,u),s=t.concat([a,c]);return e[r].apply(e,s)})},r.parsePath=function(e){var t=r.splitPath(e),n=t.pop();return{dirPath:t.join("/"),fileName:n}},r.splitPath=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e=e.replace(/^\.\//,""),e.length>1&&e.endsWith("/"))throw new Error("Path can not end with '/'");return e.split("/").filter(Boolean)}},function(e,r,t){"use strict";r.isNotFoundError=function(e){return e&&"NotFoundError"===e.name},r.isTypeMismatchError=function(e){return e&&"TypeMismatchError"===e.name}},function(e,r,t){"use strict";var n=null,i=null;r.get=function(){if(n)return n;throw new Error("Filesystem not initialized.")},r.set=function(e,r){n=e,i=r},r.getType=function(){return i}},function(e,r,t){"use strict";function n(e,r){return o.promiseCall(e,"getDirectory",r,{create:!0,exclusive:!1})}function i(e,r){return o.promiseCall(e,"getDirectory",r,{create:!1})}var o=t(0),u=t(1),a=t(2);r.get=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e&&"string"!=typeof e?e.isDirectory?Promise.resolve(e):Promise.reject(new DOMError("TypeMismatchError","Expected directory but got file")):o.splitPath(e).reduce(function(e,t){return e.then(function(e){var o=i(e,t);return r.create&&(o=o.catch(function(r){return u.isNotFoundError(r)?n(e,t):Promise.reject(r)})),o})},Promise.resolve(a.get()))},r.read=function(e){return o.promiseCall(e.createReader(),"readEntries")},r.readDeep=function(e){return r.read(e).then(function(e){var t=e.map(function(e){return e.isDirectory?r.readDeep(e).then(function(r){return Object.assign(e,{children:r})}):Promise.resolve(e)});return Promise.all(t)})}},function(e,r,t){"use strict";function n(e,t,n,i){if(e===t)return Promise.resolve();var a=u.parsePath(t),c=a.dirPath,s=a.fileName;return Promise.all([r.getEntry(e),f.get(c,i)]).then(function(e){var r=o(e,2),t=r[0],i=r[1];return u.promiseCall(t,n,i,s)})}function i(e){if(e!==window.PERSISTENT&&e!==window.TEMPORARY)throw new Error("Unknown storage type "+e)}var o=function(){function e(e,r){var t=[],n=!0,i=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(n=(u=a.next()).done)&&(t.push(u.value),!r||t.length!==r);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=t(0),a=t(1),c=t(2),s=t(5),f=t(3),l=t(6),d=t(7);r.isSupported=function(){return Boolean(window.webkitRequestFileSystem)},r.init=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.hasOwnProperty("type")?e.type:window.PERSISTENT,t=e.bytes||1048576;i(r);var n=r===window.PERSISTENT&&(!e.hasOwnProperty("requestQuota")||e.requestQuota);return Promise.resolve().then(function(){return n?d.requestPersistent(t):t}).then(function(e){return u.promiseCall(window,"webkitRequestFileSystem",r,e)}).then(function(e){return c.set(e.root,r),e})},r.usage=function(){return d.usage(c.getType())},r.getRoot=function(){return c.get()},r.readFile=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s.get(e).then(function(e){return s.read(e,r)})},r.writeFile=function(e,r){return s.get(e,{create:!0,overwrite:!0}).then(function(e){return s.write(e,r,{append:!1})})},r.appendFile=function(e,r){return s.get(e,{create:!0,overwrite:!1}).then(function(e){return s.write(e,r,{append:!0})})},r.unlink=function(e){return s.get(e).then(function(e){return u.promiseCall(e,"remove")},function(e){return a.isNotFoundError(e)?Promise.resolve(!1):Promise.reject(e)})},r.rename=function(e,r){return n(e,r,"moveTo",arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})},r.copy=function(e,r){return n(e,r,"copyTo",arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})},r.rmdir=function(e){return f.get(e).then(function(e){return e===c.get()?Promise.reject("Can not remove root. Use clear() to clear fs."):u.promiseCall(e,"removeRecursively")},function(e){return a.isNotFoundError(e)?Promise.resolve(!1):Promise.reject(e)})},r.mkdir=function(e){return f.get(e,{create:!0})},r.exists=function(e){return r.getEntry(e).then(function(){return!0},function(e){return!a.isNotFoundError(e)&&Promise.reject(e)})},r.stat=function(e){return r.getEntry(e).then(function(e){return l.get(e)})},r.readdir=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return f.get(e).then(function(e){return r.deep?f.readDeep(e):f.read(e)})},r.clear=function(){return r.readdir("/").then(function(e){var r=e.map(function(e){return e.isDirectory?u.promiseCall(e,"removeRecursively"):u.promiseCall(e,"remove")});return Promise.all(r)})},r.getUrl=function(e){return r.getEntry(e).then(function(e){return e.toURL()})},r.getEntry=function(e){return s.get(e).catch(function(r){return a.isTypeMismatchError(r)?f.get(e):Promise.reject(r)})}},function(e,r,t){"use strict";function n(e){return"string"==typeof e?"text/plain":"application/octet-binary"}function i(e,r,t){switch(e){case"ArrayBuffer":return r.readAsArrayBuffer(t);case"BinaryString":return r.readAsBinaryString(t);case"DataURL":return r.readAsDataURL(t);case"Text":default:return r.readAsText(t)}}function o(e,r){return a.promiseCall(e,"getFile",r,{create:!0,exclusive:!1})}function u(e,r){return a.promiseCall(e,"getFile",r,{create:!1})}var a=t(0),c=t(1),s=t(3);r.get=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e&&"string"!=typeof e)return e.isFile?Promise.resolve(e):Promise.reject(new DOMError("TypeMismatchError","Expected file but got directory"));var t=a.parsePath(e),n=t.dirPath,i=t.fileName;return Promise.resolve().then(function(){return s.get(n,r)}).then(function(e){return r.create?r.overwrite?o(e,i):u(e,i).catch(function(r){return c.isNotFoundError(r)?o(e,i):Promise.reject(r)}):u(e,i)})},r.write=function(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return a.promiseCall(e,"createWriter").then(function(e){return new Promise(function(i,o){if(t.append)e.seek(e.length),e.onwriteend=i;else{var u=!1;e.onwriteend=function(){u?i():(u=!0,this.truncate(this.position))}}e.onerror=o;var a=new Blob([r],{type:n(r)});e.write(a)})}).then(function(){return e})},r.read=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.promiseCall(e,"file").then(function(e){return new Promise(function(t,n){var o=new FileReader;o.onload=function(){return t(o.result)},o.onerror=function(){return n(o.error)},i(r.type,o,e)})})}},function(e,r,t){"use strict";var n=t(0);r.get=function(e){return n.promiseCall(e,"getMetadata").then(function(r){return{isFile:e.isFile,isDirectory:e.isDirectory,name:e.name,fullPath:e.fullPath,modificationTime:r.modificationTime,size:r.size}})}},function(e,r,t){"use strict";function n(e){return e===window.PERSISTENT?navigator.webkitPersistentStorage:navigator.webkitTemporaryStorage}var i=function(){function e(e,r){var t=[],n=!0,i=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(n=(u=a.next()).done)&&(t.push(u.value),!r||t.length!==r);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=t(0);r.requestPersistent=function(e){var r=n(window.PERSISTENT);return o.promiseCall(r,"requestQuota",e).then(function(r){return r>0?r:Promise.reject("Quota not granted (requested: "+e+", granted: "+r+")")})},r.usage=function(e){var r=n(e);return o.promiseCall(r,"queryUsageAndQuota").then(function(e){var r=i(e,2);return{usedBytes:r[0],grantedBytes:r[1]}})}}])});